<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explore Pod: {{ pod_name }}</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/xterm/4.14.0/xterm.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xterm/4.14.0/xterm.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
        }
        .header {
            background-color: #01a982;
            color: white;
            padding: 15px 0;
            margin-bottom: 20px;
        }
        .tab-content {
            padding: 20px;
        }
        pre {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            max-height: 70vh;
            overflow-y: auto;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .terminal-container {
            height: 70vh;
            background-color: #000;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
        }
        #terminal {
            width: 100%;
            height: 100%;
        }
        .command-input {
            margin-top: 10px;
            display: flex;
        }
        .command-input input {
            flex-grow: 1;
            margin-right: 10px;
        }
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 3px solid #007bff;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <h1>Pod: {{ pod_name }}</h1>
                <a href="/" class="btn btn-outline-light">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </a>
            </div>
            <p class="mb-0">Namespace: {{ namespace }}</p>
        </div>
    </div>

    <div class="container">
        <ul class="nav nav-tabs" id="podTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="describe-tab" data-bs-toggle="tab" data-bs-target="#describe" type="button" role="tab" aria-controls="describe" aria-selected="true">
                    <i class="fas fa-info-circle"></i> Describe
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="logs-tab" data-bs-toggle="tab" data-bs-target="#logs" type="button" role="tab" aria-controls="logs" aria-selected="false">
                    <i class="fas fa-file-alt"></i> Logs
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="access-tab" data-bs-toggle="tab" data-bs-target="#access" type="button" role="tab" aria-controls="access" aria-selected="false">
                    <i class="fas fa-terminal"></i> Access
                </button>
            </li>
        </ul>

        <div class="tab-content" id="podTabsContent">
            <div class="tab-pane fade show active" id="describe" role="tabpanel" aria-labelledby="describe-tab">
                <div id="describeLoading" class="loading">
                    <div class="spinner"></div>
                </div>
                <pre id="describeOutput" style="display: none;"></pre>
            </div>
            <div class="tab-pane fade" id="logs" role="tabpanel" aria-labelledby="logs-tab">
                <div id="logsLoading" class="loading">
                    <div class="spinner"></div>
                </div>
                <pre id="logsOutput" style="display: none;"></pre>
                <div class="mt-3">
                    <button class="btn btn-primary" id="refreshLogs">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button class="btn btn-secondary" id="downloadLogs">
                        <i class="fas fa-download"></i> Download
                    </button>
                </div>
            </div>
            <div class="tab-pane fade" id="access" role="tabpanel" aria-labelledby="access-tab">
                <div class="terminal-container">
                    <div id="terminal"></div>
                </div>
                <div class="command-input">
                    <input type="text" id="commandInput" class="form-control" placeholder="Enter command to execute">
                    <button class="btn btn-primary" id="runCommand">
                        <i class="fas fa-play"></i> Run
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Store the namespace and pod name in JavaScript variables
        const namespace = "{{ namespace }}";
        const podName = "{{ pod_name }}";
        let terminal;

        // Fetch pod description when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadPodDescription();
            
            // Set up tab handlers
            document.getElementById('logs-tab').addEventListener('click', loadPodLogs);
            document.getElementById('access-tab').addEventListener('click', setupTerminal);
            
            // Set up button handlers
            document.getElementById('refreshLogs').addEventListener('click', loadPodLogs);
            document.getElementById('downloadLogs').addEventListener('click', downloadLogs);
            document.getElementById('runCommand').addEventListener('click', runCommand);
            document.getElementById('commandInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    runCommand();
                }
            });
        });

        function loadPodDescription() {
            document.getElementById('describeLoading').style.display = 'flex';
            document.getElementById('describeOutput').style.display = 'none';
            
            fetch('/api/pod/describe', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `namespace=${namespace}&pod_name=${podName}`
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('describeOutput').textContent = data.output;
                document.getElementById('describeLoading').style.display = 'none';
                document.getElementById('describeOutput').style.display = 'block';
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('describeOutput').textContent = 'Error loading pod description.';
                document.getElementById('describeLoading').style.display = 'none';
                document.getElementById('describeOutput').style.display = 'block';
            });
        }

        function loadPodLogs() {
            document.getElementById('logsLoading').style.display = 'flex';
            document.getElementById('logsOutput').style.display = 'none';
            
            fetch('/api/pod/logs', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `namespace=${namespace}&pod_name=${podName}&tail_lines=1000`
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('logsOutput').textContent = data.output;
                document.getElementById('logsLoading').style.display = 'none';
                document.getElementById('logsOutput').style.display = 'block';
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('logsOutput').textContent = 'Error loading pod logs.';
                document.getElementById('logsLoading').style.display = 'none';
                document.getElementById('logsOutput').style.display = 'block';
            });
        }

        function downloadLogs() {
            const logsContent = document.getElementById('logsOutput').textContent;
            const blob = new Blob([logsContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${podName}-logs.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function setupTerminal() {
            if (!terminal) {
                terminal = new Terminal({
                    cursorBlink: true,
                    theme: {
                        background: '#000000',
                        foreground: '#ffffff'
                    }
                });
                
                terminal.open(document.getElementById('terminal'));
                terminal.writeln('Welcome to the pod terminal.');
                terminal.writeln('Enter a command and click "Run" to execute it in the pod.');
                terminal.writeln('');
            }
        }

        function runCommand() {
            const command = document.getElementById('commandInput').value;
            if (!command) return;
            
            terminal.writeln(`> ${command}`);
            
            fetch('/api/pod/exec', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `namespace=${namespace}&pod_name=${podName}&command=${encodeURIComponent(command)}`
            })
            .then(response => response.json())
            .then(data => {
                terminal.writeln(data.output);
                terminal.writeln('');
            })
            .catch(error => {
                console.error('Error:', error);
                terminal.writeln('Error executing command.');
                terminal.writeln('');
            });
            
            document.getElementById('commandInput').value = '';
        }
    </script>
</body>
</html> 